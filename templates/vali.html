<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <meta http-equiv="Refresh" content="120">
    <title>Tracking Intertug: Vali</title>
    <style>
      html, body, #map-canvas {
        font-size: 16px;
        height: 100%;
        margin: 0px;
        padding: 0px;
      }
      figure{
        width: 100%;
        margin: 0;
      }
      .bold{
        font-weight: bold;
      }
      #img{
        width: 100%;
        height: 95%;
        margin: 0;
        border-radius: 4px;
      }
      #flag{
        width: 100%;
        height: 20px;
        margin: 0;
        border-radius: 4px;
      }
      .tit{
        font-weight: bold;
        text-align: center;
        color: white;
      }
      #menu{
        background: #FFCA08;
        color: black;
        float: right;
        font-size: 1.01em;
        font-style: sans-serif;
        height: 100%;
        overflow: auto;
        position: absolute;
        right: 0;
        top: 0;
        width: 33%;
        border-radius: 5px;
        margin: 0;
      }
      table{
        margin: 0.3em;
        color: white;

      }
      .datos{
        margin: 0.5em;
        border-radius: 3px;
        color: white;
        font-size: 0.9em;
        text-align: center;
        background-color: #0000AA;
      }
      .par{
        background-color: #000080;
        margin: 0 0.3em;
      }
      .impar{
        background-color: #0000FF;
        margin: 0 0.3em;
        }
      tr{
        /* Todas las filas blancas */
        background-color: #000080;
      }
      tr:nth-child(2n+1){
        /* Filas impares grises */
        background-color: #0000AA;
      }
      tr:hover{
        /* Filas celeste al pasar el mouse */
        background-color: #FFCA08;
      }
      article{
        margin: 0.5em;
        border-bottom: 0.1em solid gray;
        font-size: 0.9em;
      }
      #atras{
        font-size: 1em;
        color: white;
        background: #0000AA;
        padding: 0.3em;
        border-radius: 10px;
        float: left;
        margin: 0.3em;
        text-decoration: none;
      }
      #hoy{
        font-size: 1em;
        color: white;
        background: #0000AA;
        padding: 0.3em;
        border-radius: 10px;
        float: right;
        margin: 0.3em;
        text-decoration: none;
      }

    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3&sensor=false&language=es"></script>
    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
    <link rel="stylesheet" src="//normalize-css.googlecode.com/svn/trunk/normalize.css" />
  </head>
  <body>
    <div id="map-canvas"></div>

    <section id="menu">
      <article>
        <a id="atras" href="/">Flota</a>
        <a id="atras" href="/peru">Flota Perú</a>
        <a id="hoy" href="/vali">Hoy</a>
        <figure>
          <img id="img" src="http://i.imgur.com/Kpo5NAm.jpg">
          <img id="flag" src="http://i.imgur.com/9oCr1Nf.gif">
          <figurecaption>
            <p class="datos"> <span class="par">Nombre: Vali</span> <span class="impar">Año: 2006</span> <span class="par">Bollard Pull: 45 Ton</span> <span class="impar">Velocidad: 12 Nudos</span></p>
          </figurecaption>         
        </figure>
      </article>
      <article>
      <h3 class="tit">Propulsión</h3>
      <table>
        <tr class="bold">
          <td>Datos</td>
          <td>Babor</td>
          <td>Estribor</td>
          <td>Unidades</td>
        </tr>
        <tr>
          <td class="bold">Date</td>
          <td>{{rowsPropB.0.0}}</td>
          <td>{{rowsPropE.0.0}}</td>
          <td></td>
        </tr>
        <tr>
          <td class="bold">Total Hours</td>
          <td>{{rowsPropB.0.1}}</td>
          <td>{{rowsPropE.0.1}}</td>
          <td>Horas</td>
        </tr>
        <tr>
          <td class="bold">Total Fuel</td>
          <td>{{rowsPropB.0.2}}</td>
          <td>{{rowsPropE.0.2}}</td>
          <td>Litros</td>
        </tr>
        <tr>
          <td class="bold">Engine Speed</td>
          <td>{{rowsPropB.0.3}}</td>
          <td>{{rowsPropE.0.3}}</td>
          <td>RPM</td>
        </tr>
        <tr>
          <td class="bold">Percent Load</td>
          <td>{{rowsPropB.0.4}}</td>
          <td>{{rowsPropE.0.4}}</td>
          <td>%</td>
        </tr>
        <tr>
          <td class="bold">Fuel rate</td>
          <td>{{rowsPropB.0.5}}</td>
          <td>{{rowsPropE.0.5}}</td>
          <td>L/H</td>
        </tr>
        <tr>
          <td class="bold">Coolant Temp</td>
          <td>{{rowsPropB.0.6}}</td>
          <td>{{rowsPropE.0.6}}</td>
          <td>°C</td>
        </tr>
        <tr>
          <td class="bold">Oil Temp</td>
          <td>{{rowsPropB.0.7}}</td>
          <td>{{rowsPropE.0.7}}</td>
          <td>°C</td>
        </tr>
        <tr>
          <td class="bold">Oil Pressure</td>
          <td>{{rowsPropB.0.8}}</td>
          <td>{{rowsPropE.0.8}}</td>
          <td>KPa</td>
        </tr>
        <tr>
          <td class="bold">Intercooler Temp</td>
          <td>{{rowsPropB.0.9}}</td>
          <td>{{rowsPropE.0.9}}</td>
          <td>°C</td>
        </tr>
      </table>
      </article>
      <article>
      <h3 class="tit">Generación</h3>
      <table>
        <tr class="bold">
          <td>Datos</td>
          <td>Babor</td>
          <td>Estribor</td>
          <td>Unidades</td>
        </tr>
        <tr>
          <td class="bold">Date</td>
          <td>{{rowsGenB.0.0}}</td>
          <td>{{rowsGenE.0.0}}</td>
          <td></td>
        </tr>
        <tr>
          <td class="bold">Tolal Hours</td>
          <td>{{rowsGenB.0.1}}</td>
          <td>{{rowsGenE.0.1}}</td>
          <td>Horas</td>
        </tr>
        <tr>
          <td class="bold">Trip Hours</td>
          <td>{{rowsGenB.0.2}}</td>
          <td>{{rowsGenE.0.2}}</td>
          <td>Horas</td>
        </tr>
        <tr>
          <td class="bold">Start Counter</td>
          <td>{{rowsGenB.0.3}}</td>
          <td>{{rowsGenE.0.3}}</td>
          <td></td>
        </tr>
        <tr>
          <td class="bold">RPM</td>
          <td>{{rowsGenB.0.4}}</td>
          <td>{{rowsGenE.0.4}}</td>
          <td>RPM</td>
        </tr>
        <tr>
          <td class="bold">Oil Pressure</td>
          <td>{{rowsGenB.0.5}}</td>
          <td>{{rowsGenE.0.5}}</td>
          <td>Bar</td>
        </tr>
        <tr>
          <td class="bold">HTC Outlet Temp</td>
          <td>{{rowsGenB.0.6}}</td>
          <td>{{rowsGenE.0.6}}</td>
          <td>°C</td>
        </tr>
        <tr>
          <td class="bold">Lube Oil Temp</td>
          <td>{{rowsGenB.0.7}}</td>
          <td>{{rowsGenE.0.7}}</td>
          <td>°C</td>
        </tr>
        <tr>
          <td class="bold">HTC Pressure</td>
          <td>{{rowsGenB.0.8}}</td>
          <td>{{rowsGenE.0.8}}</td>
          <td>Bar</td>
        </tr>
        <tr>
          <td class="bold">Fuel Pressure</td>
          <td>{{rowsGenB.0.9}}</td>
          <td>{{rowsGenE.0.9}}</td>
          <td>Bar</td>
        </tr>
        <tr>
          <td class="bold">Battery Volatge</td>
          <td>{{rowsGenB.0.10}}</td>
          <td>{{rowsGenE.0.10}}</td>
          <td>V</td>
        </tr>
      </table>
      </article>
      <article class="form">
        <h3 class="tit">Consulta</h3>
        <form method="get">
        <input type="date" name="fecha" value="" class="fecha" style='width:90%'/>
        <input type="number" name="hora1" min="0" max="24" class="hora" value="00"/>:
        <input type="number" name="minutos1" min="0" max="60" class="minuto" value="00"/> a
        <input type="number" name="hora2" min="0" max="24" class="hora" value="23"/>:
        <input type="number" name="minutos2" min="0" max="60" class="minuto" value="59"/>
        <input type="submit" value="Consultar" id="consulta"/>
        </form>
      </article>
    </section>

    <script>

    var image = "http://i.imgur.com/qqxD2uN.png";//"http://i.imgur.com/yoZQPZu.gif";
    var imagenPlataforma = "http://i.imgur.com/7Ecw2M5.png";
    var imagenPropuesta = "http://s7.postimg.org/pz2ndrm9z/Offshore_Tower_Red.png?noCache=1422656982";
    var imagenMuelle = "http://i.imgur.com/OfPqcEL.png";
    var imageWaves = "http://s8.postimg.org/3u8drhhsx/Waves.png?noCache=1422657376";
    var imageBoya = "http://s17.postimg.org/qhedoohvf/boya2.png?noCache=1424120237";

      var infoVentana = null;

  var puntos = {};
//puntos["cx11"] = {
//  center: new google.maps.LatLng(-3.595417, -80.737167),
//  html: "Zona de Fondeo Remolcadores - Lado Tierra CX11",
//};
puntos["cx15"] = {
  center: new google.maps.LatLng(-3.617833, -80.751183),
  html: "Zona de Fondeo Remolcadores - Lado Sur CX15",
};
//puntos["albacorat"] = {
//  center: new google.maps.LatLng(-3.423167, -80.572900),
//  html: "Zona de Fondeo Remolcadores - Lado Tierra Albacora",
//};
puntos["albacoras"] = {
  center: new google.maps.LatLng(-3.435783, -80.590333),
  html: "Zona de Fondeo Remolcadores - Lado Sur Albacora",
};

        var AmarraderoAlbacoraN;
        var AmarraderoAlbacoraS;
  var AmarraderoCorvinaB;
  var AmarraderoCorvina;
  var mapa;

      function inicial() {
        var opciones = {
          zoom: 12,
          center: new google.maps.LatLng( {{loopVali.0.0}} , {{loopVali.0.1}} ),
          mapTypeId: google.maps.MapTypeId.TERRAIN,
          mapTypeControl: true,
          streetViewControl: false,
          mapTypeControlOptions:{
            position: google.maps.ControlPosition.LEFT_TOP
          },
          zoomControlOptions: {
            position: google.maps.ControlPosition.LEFT_CENTER
          },
          panControlOptions: {
            position: google.maps.ControlPosition.LEFT_CENTER
          },
          scaleControl: true,
          scaleControlOptions: {
            position: google.maps.ControlPosition.BOTTOM_CENTER
          },
        };

        mapa = new google.maps.Map(document.getElementById('map-canvas'), opciones);

        var recorrido = [

          {% for i in loopVali %}

            new google.maps.LatLng({{i.0}},{{i.1}}),

          {% endfor %}

        ];

        var flecha = {
          path: google.maps.SymbolPath.FORWARD_OPEN_ARROW,
          scale: 1.05,
          strokeColor: '#11FB34'//'#11FB34'
        };

        var linea = new google.maps.Polyline({
          path: recorrido,
          map: mapa,
          icons: [{
            icon: flecha,
            offset: '50%',
            repeat: "20px"
          }],
          geodesic: true,
          strokeColor: '#11FB34',//'#11FB34',
          strokeOpacity: 1.0,
          strokeWeight: 2
        });

        dato = recorrido.length;
        var marcador = new google.maps.Marker({
          position: new google.maps.LatLng(recorrido[dato - 1]['k'], recorrido[dato - 1]['A']),
          map: mapa,
          icon: image,
          draggable: false,
          title: "Vali",
          zIndex: 1,
        });

for (var p in puntos) {
    var circleOptions = {
      strokeColor: '#FF0000',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FF0000',
      fillOpacity: 0.35,
      map: mapa,
      center: puntos[p].center,
      radius: 500
    };
    // Add the circle for this city to the map.
    circle = new google.maps.Circle(circleOptions);
  }

      AmarraderoAlbacoraN.setMap(mapa);
      AmarraderoAlbacoraS.setMap(mapa);
      AmarraderoCorvinaB.setMap(mapa);
      AmarraderoCorvina.setMap(mapa);
        setMarcadores(mapa, tugs);
        setMarkers(mapa, plataformas);
        setUltimo(mapa, tugs);
        infoVentana = new google.maps.InfoWindow({
          content: ""
        });
      }
     // Define the LatLng coordinates for the polygon's path.
  var AmarraderoAlbacoraSCoords = [
    new google.maps.LatLng(-3.418054, -80.590462),
    new google.maps.LatLng(-3.415512, -80.589995),
    new google.maps.LatLng(-3.414516, -80.588213),
    //new google.maps.LatLng(-3.413610, -80.585864),
    //new google.maps.LatLng(-3.415247, -80.585188),
    new google.maps.LatLng(-3.415872, -80.587411),
  ];

  var AmarraderoAlbacoraNCoords = [
    //new google.maps.LatLng(-3.418054, -80.590462),
    //new google.maps.LatLng(-3.415512, -80.589995),
    new google.maps.LatLng(-3.414516, -80.588213),
    new google.maps.LatLng(-3.413610, -80.585864),
    new google.maps.LatLng(-3.415247, -80.585188),
    new google.maps.LatLng(-3.415872, -80.587411),
  ];

    var AmarraderoCorvinaBCoords = [
    new google.maps.LatLng(-3.591131, -80.747214),
    new google.maps.LatLng(-3.588697, -80.745703),
    new google.maps.LatLng(-3.588037, -80.747269),
    new google.maps.LatLng(-3.590471, -80.748502),
  ];

    var AmarraderoCorvinaCoords = [
    new google.maps.LatLng(-3.586989, -80.751051),
    new google.maps.LatLng(-3.584799, -80.749836),
    new google.maps.LatLng(-3.584022, -80.751340),
    new google.maps.LatLng(-3.586302, -80.752419),
  ];

  // Construct the polygon.
  AmarraderoAlbacoraN = new google.maps.Polygon({
    paths: AmarraderoAlbacoraNCoords,
    strokeColor: '#FF0000',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: '#FF0000',
    fillOpacity: 0.35,
    html: "<h4>Amarraderos Albacora Norte<br/>(Multiboyas para Buque Tanque)</h4>",
  });

  AmarraderoAlbacoraS = new google.maps.Polygon({
    paths: AmarraderoAlbacoraSCoords,
    strokeColor: '#FF0000',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: '#FF0000',
    fillOpacity: 0.35,
    html: "<h4>Amarraderos Albacora Sur<br/>(Multiboyas para Buque Tanque)</h4>",
  });
    // Construct the polygon.

  AmarraderoCorvinaB = new google.maps.Polygon({
    paths: AmarraderoCorvinaBCoords,
    strokeColor: '#FF0000',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: '#FF0000',
    fillOpacity: 0.35, 
    html: "<h4>Amarradero N° 1 para Barcaza<br/>Área Corvina</h4>",
  });

    // Construct the polygon.
  AmarraderoCorvina = new google.maps.Polygon({
    paths: AmarraderoCorvinaCoords,
    strokeColor: '#FF0000',
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: '#FF0000',
    fillOpacity: 0.35,
    html: "<h4>Amarradero N° 1 para Buque Tanque<br/>Área Corvina</h4>",
  });

  var infowindow = new google.maps.InfoWindow(
   { 
     size: new google.maps.Size(150,50)
   });

  google.maps.event.addListener(AmarraderoAlbacoraN,'click', function(event) {
    var point = AmarraderoAlbacoraN.getPath().getAt(0);
    infowindow.setContent(AmarraderoAlbacoraN.html);
    if (event) {
       point = event.latLng;
    }
    infowindow.setPosition(point);
    infowindow.open(mapa);
    // map.openInfoWindowHtml(point,html); 
  }); 

  google.maps.event.addListener(AmarraderoAlbacoraS,'click', function(event) {
    var point = AmarraderoAlbacoraS.getPath().getAt(0);
    infowindow.setContent(AmarraderoAlbacoraS.html);
    if (event) {
       point = event.latLng;
    }
    infowindow.setPosition(point);
    infowindow.open(mapa);
    // map.openInfoWindowHtml(point,html); 
  });

  google.maps.event.addListener(AmarraderoCorvina,'click', function(event) {
    var point = AmarraderoCorvina.getPath().getAt(0);
    infowindow.setContent(AmarraderoCorvina.html);
    if (event) {
       point = event.latLng;
    }
    infowindow.setPosition(point);
    infowindow.open(mapa);
    // map.openInfoWindowHtml(point,html); 
  }); 

    google.maps.event.addListener(AmarraderoCorvinaB,'click', function(event) {
    var point = AmarraderoCorvinaB.getPath().getAt(0);
    infowindow.setContent(AmarraderoCorvinaB.html);
    if (event) {
       point = event.latLng;
    }
    infowindow.setPosition(point);
    infowindow.open(mapa);
    // map.openInfoWindowHtml(point,html); 
  }); 
  

    var tugs = [

          {% for i in loopVali %}

            ["Vali", {{i.0}}, {{i.1}}, 1, "Nombre: <strong>Vali</strong> <br/> Posición: {{i.0}}, {{i.1}} <br/> Fecha: {{i.3}} <br/> Velocidad:  {{i.2}} Nudos"], 

          {% endfor %}

    ];

    var alert = [

          {% for i in loopVali %}

            {{i.2}}, 

          {% endfor %}

    ];

    var plataformas = [

      ["existente", -3.59541666666, -80.73716666666667, 1, "<h3>CX11</h3>"],
      ["existente", -3.60750, -80.73667, 1, "<h3>CX15</h3>"],
      ["existente", -3.42000, -80.58362, 1, "<h3>Z1-8-A</h3>"],
      ["muelle", -3.633691, -80.587355, 1, "<h3>Muelle La Cruz</h3>"],
      //["boya", -3.414516, -80.588213, 1, "<h3>Amarraderos Albacora Norte  y Sur <br/>(Multiboyas para Buque Tanque)</h3>"],
      //["boya", -3.588037, -80.747269, 1, "<h3>Amarradero N° 1 para  Barcaza <br/> Área Corvina</h3>"],
      //["boya", -3.584022, -80.751340, 1, "<h3>Amarradero N° 1 para  Buque Tanque <br/> Área Corvina</h3>"],
      //["zona", -3.599067, -80.704733, 1, "Corvina Este-1X"],
      //["zona", -3.570900, -80.829583, 1, "Zona R"],
      //["zona", -3.540667, -80.853617, 1, "Z1-305"],
      //["propuesta", -3.522417, -80.845783, 1, "Raya: Zona A"],
      //["propuesta", -3.632433, -80.776300, 1, "Zona B-Delfin 1X"],
      //["propuesta", -3.762750, -80.864067, 1, "Piedra Redonda Z1-14"],
      //["existente", -3.806533, -80.891750, 1, "Piedra Redonda"],

    ];


    function setMarkers(mapa, markers){

        for (var i = 0; i < markers.length; i++) {

        var plataformas = markers[i];
        var platLatLon = new google.maps.LatLng(plataformas[1], plataformas[2]);
        var marcador = new google.maps.Marker({
          position: platLatLon,
          map: mapa,
          icon: (plataformas[0] == "muelle" ? imagenMuelle : (plataformas[0] == "existente" ? imagenPlataforma : ( plataformas[0] == "zona"? imageWaves: (plataformas[0] == "boya" ? imageBoya: imagenPropuesta)))),
          draggable: false,
          title: plataformas[0],
          zIndex: plataformas[3],
          html: plataformas[4],
        });

        google.maps.event.addListener(marcador, "mouseover", function () {
          infoVentana.setContent(this.html);
          infoVentana.open(mapa, this);
        });

      }
    }

    function setUltimo(mapa, markers){

        var plataformas = markers[markers.length-1];
        var platLatLon = new google.maps.LatLng(plataformas[1], plataformas[2]);
        var marcador = new google.maps.Marker({
          position: platLatLon,
          map: mapa,
          icon: image,
          draggable: false,
          title: plataformas[0],
          zIndex: plataformas[3],
          html: plataformas[4],
        });

        google.maps.event.addListener(marcador, "mouseover", function () {
          infoVentana.setContent(this.html);
          infoVentana.open(mapa, this);
        });

        google.maps.event.addListener(marcador, "mouseout", function () {
          infoVentana.close();

        });
      
    } 

    function setMarcadores(mapa, marcadores) {

      for (var i = 0; i < marcadores.length; i++) {

        var tugs = marcadores[i];
        var tugsLatLon = new google.maps.LatLng(tugs[1], tugs[2]);
        var marcador = new google.maps.Marker({
          position: tugsLatLon,
          map: mapa,
          icon:{
            path: google.maps.SymbolPath.CIRCLE,
            scale: 2,
            strokeColor: ( alert[i] > 9 ? 'red' : '#11FB34')//'#11FB34' )
          },
          draggable: false,
          title: tugs[0],
          html: tugs[4],
          zIndex: tugs[3],
        });

        google.maps.event.addListener(marcador, "mouseover", function () {
          infoVentana.setContent(this.html);
          infoVentana.open(mapa, this);
        });

        google.maps.event.addListener(marcador, "mouseout", function () {
          infoVentana.close();

        });
      }
    }


    google.maps.event.addDomListener(window, 'load', inicial);

    </script>
  </body>
</html>